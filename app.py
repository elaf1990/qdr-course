import streamlit as st
st.set_page_config(page_title="ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ูุณุชูู ุงููุฏุฑุงุช - ููู", layout="centered")
st.title(" ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ูุณุชูู ุงููุฏุฑุงุช - ููู")
import matplotlib.pyplot as plt
import json
from datetime import datetime
from fpdf import FPDF



PASSWORD = "qdr2025"  


password = st.text_input("ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ููุฏุฎูู ุฅูู ุงูุงุฎุชุจุงุฑ", type="password")

if password != PASSWORD:
    st.warning("ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ ุฃู ูู ุชูุฏุฎู ุจุนุฏ.")
    st.stop()  


st.set_page_config(page_title="ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ูุณุชูู ุงููุฏุฑุงุช - ููู", layout="centered")
st.title(" ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ูุณุชูู ุงููุฏุฑุงุช - ููู")

# ุฅุฏุฎุงู ุงุณู ุงูุทุงูุจ
student_name = st.text_input("๐ค ุฃุฏุฎู ุงุณูู ุงููุงูู (ูุทููุจ ูุญูุธ ูุชูุฌุชู):")

questions = {
    "ุงููุณุจ": [
        {"question": "ุฅุฐุง ูุงูุช ุงููุณุจุฉ ุจูู ุณ ูุต ูู 2:3ุ ููุงู ุณ = 4ุ ููุง ูููุฉ ุตุ", "options": ["6", "3", "8", "5"], "answer": "6"},
        {"question": "ุฅุฐุง ูุงูุช ุงููุณุจุฉ ุจูู ุฃ ุฅูู ุจ ูู 5:2ุ ูุจ = 8ุ ููุง ูููุฉ ุฃุ", "options": ["20", "16", "10", "12"], "answer": "20"},
        {"question": "ูุณุจุฉ ุงููุฌุงุญ 80% ูู 250 ุทุงูุจุ ูู ุนุฏุฏ ุงููุงุฌุญููุ", "options": ["200", "180", "220", "210"], "answer": "200"},
        {"question": "ุฅุฐุง ูุงู ุซูู ุณูุนุฉ ุจุนุฏ ุงูุฎุตู 75 ุฑูุงูุ ูุงูุฎุตู 25%ุ ููุง ุงูุซูู ุงูุฃุตููุ", "options": ["100", "95", "90", "110"], "answer": "100"},
        {"question": "ุฅุฐุง ูุงู ุณ:ุต = 4:7ุ ูุณ + ุต = 66ุ ููุง ูููุฉ ุณุ", "options": ["24", "28", "30", "22"], "answer": "24"},
    ],
    "ุงูุฌุจุฑ": [
        {"question": "ุฅุฐุง ูุงู 3ุณ = 12ุ ููุง ูููุฉ ุณุ", "options": ["4", "3", "5", "6"], "answer": "4"},
        {"question": "ุญู ุงููุนุงุฏูุฉ: ุณ + 5 = 9", "options": ["4", "5", "6", "3"], "answer": "4"},
        {"question": "ุฅุฐุง ูุงู 2ุณ - 3 = 7ุ ููุง ูููุฉ ุณุ", "options": ["5", "4", "6", "3"], "answer": "5"},
        {"question": "ุฅุฐุง ูุงู ุณยฒ = 36ุ ููุง ูููุฉ ุณุ (ุงูููุฌุจ ููุท)", "options": ["6", "5", "4", "3"], "answer": "6"},
        {"question": "ุฅุฐุง ูุงู (ุณ + 2)(ุณ - 3) = 0ุ ููุง ุฃุญุฏ ุญููู ุณุ", "options": ["3", "-2", "0", "1"], "answer": "3"},
    ],
    "ุงูููุฏุณุฉ": [
        {"question": "ูุญูุท ูุฑุจุน ุทูู ุถูุนู 5 ุณูุ ูุง ุงููุญูุทุ", "options": ["20", "25", "15", "10"], "answer": "20"},
        {"question": "ูุณุงุญุฉ ุฏุงุฆุฑุฉ ูุตู ูุทุฑูุง 7 ุณู ุชูุฑูุจูุงุ (ฯ โ 3.14)", "options": ["153.86", "49", "44", "38.5"], "answer": "153.86"},
        {"question": "ุฒุงููุฉ ูุงุฆูุฉ ููุงุณูุงุ", "options": ["90", "45", "60", "180"], "answer": "90"},
        {"question": "ูุฌููุน ุฒูุงูุง ูุซูุซุ", "options": ["180", "90", "360", "270"], "answer": "180"},
        {"question": "ุฅุฐุง ูุงู ุงููุณุชุทูู ุทููู 8 ูุนุฑุถู 3ุ ููุง ูุณุงุญุชูุ", "options": ["24", "22", "11", "18"], "answer": "24"},
    ],
    "ุงูุชุญููู": [
        {"question": "ุฅุฐุง ูุงู ุงููุชูุณุท ุงูุญุณุงุจู ูู (4, 6, 8)ุ", "options": ["6", "5", "7", "8"], "answer": "6"},
        {"question": "ุฅุฐุง ูุงู ุงููุฏู ุจูู 2 ู 10ุ", "options": ["8", "12", "5", "6"], "answer": "8"},
        {"question": "ูุง ุงููุณูุท ูู ุงูุฃุนุฏุงุฏ (3, 7, 9)ุ", "options": ["7", "6", "9", "3"], "answer": "7"},
        {"question": "ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช 5, 10, 15, 20ุ ุงููุชูุณุทุ", "options": ["12.5", "10", "15", "17.5"], "answer": "12.5"},
        {"question": "ูุง ุงููุฑู ุจูู ุงููููุฉ ุงูุนุธูู ูุงูุตุบุฑูุ", "options": ["ุงููุทุงู", "ุงููุณูุท", "ุงููุชูุณุท", "ุงููุฏู"], "answer": "ุงููุฏู"},
    ],
    "ุงูุงุญุชูุงูุงุช": [
        {"question": "ุงุญุชูุงู ุธููุฑ ูุฌู ูุนูู ูู ุฑููุฉ ูุฑุฏ ุนุงุฏูุฉุ", "options": ["1/6", "1/4", "1/2", "1/3"], "answer": "1/6"},
        {"question": "ุงุญุชูุงู ุณุญุจ ูุฑูุฉ ููุจ ูู ุฃูุฑุงู ุงููุนุจ (52 ูุฑูุฉ)ุ", "options": ["1/4", "1/2", "1/3", "1/13"], "answer": "1/4"},
        {"question": "ุฅุฐุง ูุงูุช ุงุญุชูุงู ูุฌุงุญ ุงุฎุชุจุงุฑ 0.7ุ ุงุญุชูุงู ุงููุดูุ", "options": ["0.3", "0.7", "0.5", "0.2"], "answer": "0.3"},
        {"question": "ุงุญุชูุงู ุงูุญุตูู ุนูู ุนุฏุฏ ุฒูุฌู ูู ุฑููุฉ ูุฑุฏุ", "options": ["1/2", "1/3", "1/4", "2/3"], "answer": "1/2"},
        {"question": "ุงุญุชูุงู ุณุญุจ ุจุทุงูุฉ ุญูุฑุงุก ูู ุฃูุฑุงู ุงููุนุจุ", "options": ["1/2", "1/4", "1/3", "1/5"], "answer": "1/2"},
    ],
    "ุงููุชุชุงููุงุช": [
        {"question": "ุงููุตุทูุญ ุงูุฎุงูุณ ูู ุงููุชุชุงููุฉ 2ุ 4ุ 6ุ 8ุ ...ุ", "options": ["10", "12", "14", "8"], "answer": "10"},
        {"question": "ุงููุตุทูุญ ุงูุซุงูุซ ูู ูุชุชุงููุฉ 3ุ 6ุ 9ุ 12ุ ...ุ", "options": ["9", "6", "12", "15"], "answer": "9"},
        {"question": "ุงููุตุทูุญ ุงูุฃูู ูู ูุชุชุงููุฉ 5ุ 10ุ 15ุ ...ุ", "options": ["5", "10", "15", "20"], "answer": "5"},
        {"question": "ุงููุตุทูุญ ุงูุณุงุจุน ูู 1ุ 3ุ 5ุ 7ุ ...ุ", "options": ["13", "15", "17", "19"], "answer": "13"},
        {"question": "ุงููุตุทูุญ ุงูุฑุงุจุน ูู 10ุ 20ุ 30ุ 40ุ ...ุ", "options": ["40", "30", "20", "50"], "answer": "40"},
    ],
}

section_colors = {
    "ุงููุณุจ": "#3498db",
    "ุงูุฌุจุฑ": "#e67e22",
    "ุงูููุฏุณุฉ": "#2ecc71",
    "ุงูุชุญููู": "#9b59b6",
    "ุงูุงุญุชูุงูุงุช": "#f1c40f",
    "ุงููุชุชุงููุงุช": "#e74c3c",
}

user_answers = {}
st.markdown("###  ุงูุฃุณุฆูุฉ")
for section, qs in questions.items():
    st.subheader(f"๐ ูุณู: {section}")
    for i, q in enumerate(qs):
        user_answers[q["question"]] = st.radio(q["question"], q["options"], key=f"q_{section}_{i}", index=None)

if st.button(" ุนุฑุถ ุงููุชูุฌุฉ ูุงูุชุญููู"):
    section_scores = {}
    for section, qs in questions.items():
        correct = sum(user_answers.get(q["question"]) == q["answer"] for q in qs)
        score = round((correct / len(qs)) * 100) if len(qs) > 0 else 0
        section_scores[section] = score
        st.markdown(f"๐ ูุชูุฌุชู ูู ูุณู **{section}**: {score}%")

    labels = list(section_scores.keys())
    values = list(section_scores.values())
    colors = [section_colors.get(s, "#95a5a6") for s in labels]

    if all(isinstance(v, (int, float)) and not isinstance(v, bool) for v in values) and sum(values) > 0:
        st.markdown("###  ุชูุฒูุน ูุณุชูุงู ุจุงูุฑุณู ุงูุจูุงูู:")
        fig, ax = plt.subplots(figsize=(6, 6), facecolor='none')
        wedges, texts, autotexts = ax.pie(
            values,
            labels=labels,
            colors=colors,
            startangle=90,
            autopct="%1.0f%%",
            wedgeprops={'linewidth': 1, 'edgecolor': 'white'},
            textprops={'color': "black", 'fontsize': 10}
        )
        ax.axis("equal")
        fig.patch.set_alpha(0.0)
        st.pyplot(fig)
    else:
        st.warning("โ๏ธ ูู ูุชู ุฅุฏุฎุงู ูุชุงุฆุฌ ูุงููุฉ ูุฑุณู ุงูุฑุณู ุงูุจูุงูู. ุชุฃูุฏ ูู ุงูุฅุฌุงุจุฉ ุนูู ุจุนุถ ุงูุฃุณุฆูุฉ ุฃูููุง.")

    # ุชุญููู ุงููุณุชููุงุช
    weak = [s for s, v in section_scores.items() if v < 50]
    medium = [s for s, v in section_scores.items() if 50 <= v < 75]
    strong = [s for s, v in section_scores.items() if v >= 75]

    st.markdown("###  ุงูุชุญููู ุงูููุงุฆู ููุณุชูุงู:")

    if not any([weak, medium, strong]):
        st.info("โ ูู ูุชู ุงูุฅุฌุงุจุฉ ุนูู ุฃู ุณุคุงู.")
    else:
        if weak:
            st.error("โ ุงูุฃูุณุงู ุงูุถุนููุฉ:\n" + "\n".join(
                f"- {s}:  ูุณุชูุงู ุถุนูู ูู ูุฐุง ุงููุณูุ ุฃูุตุญู ุชุจุฏุฃ ุจููุงุทุน ุงูุชุฃุณูุณ ูุงูููุงููู ุงูุฃุณุงุณูุฉ." for s in weak
            ))
        if medium:
            st.warning("โ๏ธ ุงูุฃูุณุงู ุงูุชู ุชุญุชุงุฌ ุชุทููุฑ:\n" + "\n".join(
                f"- {s}: ุชุญุชุงุฌ ุชุทููุฑ ุจุณูุทุ ุฌุฑุจ ุชุฑุงุฌุน ุทุฑู ุงูุญู ุงูุณุฑูุน ูุชุฏุฑุจ ุฃูุซุฑ ุนูู ุงูุฃุณุฆูุฉ." for s in medium
            ))
        if strong:
            st.success("โ ุงูุฃูุณุงู ุงููููุฉ ูุฏูู:\n" + "\n".join(
                f"- {s}: ูุจุฑูู ูุง ูุญุด! ุฃุฏุงุคู ููุชุงุฒุ ุงุณุชูุฑ ุจุงูุชุฏุฑุจ ูุงุญุชุฑุงู ุงููุฏุฑุงุช." for s in strong
            ))

    # โ ุญูุธ ุงููุชูุฌุฉ ูู ููู JSON
    if student_name:
        result = {
            "name": student_name,
            "date": datetime.now().strftime("%Y-%m-%d"),
            "section_scores": section_scores
        }
        file_name = f"student_{student_name.strip().replace(' ', '_')}.json"
        with open(file_name, "w", encoding="utf-8") as f:
            json.dump(result, f, ensure_ascii=False, indent=4)
        st.success(f"โ ุชู ุญูุธ ูุชูุฌุชู ูู ุงูููู: {file_name}")
    else:
        st.warning("โ๏ธ ูู ูุชู ุญูุธ ุงููุชูุฌุฉ. ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณูู ุจุงูุฃุนูู.")
